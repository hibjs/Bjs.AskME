function preView(n){var t=$(n).val();$("#preview").html(marked(t))}function getData(n){var t=$(n).val();t.length>0&&t.substring(t.length-1,t.length)===" "&&t!==""&&setTimeout(function(){$.get({url:"../tags/"+t,success:function(n){renderTagSuggestions(n.data)}})},300)}function renderTagSuggestions(n){var r=$("#tag-suggestions"),t,u,f,i;if(n.length>0){r.empty();for(t in n)u=document.createElement("div"),u.addEventListener("click",function(){addTag(n[t]);r.hide();$("#tag").val("")}),f="",f=n[t].description.length>60?n[t].description.substring(0,60)+"...":n[t].description,$(u).append("<span class='post-tag'>"+n[t].tagName+"<\/span ><span class='pull-right'><a href='~/question/tagged/"+n[t].tagName+"'>@<\/a><\/span><p class='des'>"+f+"<\/p>"),r.append(u);r.show()}else i=document.createElement("a"),i.href="javascript:void(0)",i.innerText="创建标签",i.className="btn btn-ask",i.addEventListener("click",function(){openDialog($("#tag").val())}),r.empty().append(i).show()}function renderTags(n){var r=$("#tags"),u,t,i;if(r.empty(),n.length>0)for(u in n)t=document.createElement("span"),t.className="post-tag",t.innerHTML=n[u].tagName,i=document.createElement("span"),i.className="iconfont icon-close",i.addEventListener("click",function(){removeTag(n[u])}),r.append($(t).append(i));else r.hide()}function addTag(n){tags.push(n);renderTags(tags)}function removeTag(n){tags.splice($.inArray(n,tags),1);renderTags(tags)}function openDialog(n){$("#tagName").val(n);$("#addTagModal").show()}function saveTag(){$.post({url:"/user/add/tag",data:{tagName:$("#tagName").val(),des:$("#des").val()},success:function(n){n.status==200?($("#addTagModal").hide(),$("#des").val("")):alert(n.msg)},error:function(n){console.log(n.status)}})}$(function(){$("#question-btn").on("click",function(){var n=[];for(var t in tags)n.push(tags[t].id);console.log(n.toString());$.post({url:"./",data:{title:$("#title").val(),description:$("#description").val(),ids:n.toString()},traditional:!0,success:function(n){n.status===200?location.href="/":alert(n.msg)}})});$("#addBlog").on("click",function(){var n=[];for(var t in tags)n.push(tags[t].id);console.log(n.toString());$.post({url:"add/post",data:{title:$("#title").val(),content:$("#description").val(),ids:n.toString()},traditional:!0,success:function(n){console.log(n);n.status===200?alert("发布成功"):alert(n.msg)}})});$(document).click(function(){$("#tag-suggestions").hide()});$("button.modal-closebutton").click(function(){$("div.modal-wrapper").hide()})});var tags=[];